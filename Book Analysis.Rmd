```{r}
library(tidyverse)
library(readxl)
library(stringr)

monster_books <- read_excel("Saved Data Files/total_results_droppeddups.xlsx")
```


```{r}
# Grouping by staff list to ensure we're getting them all 

monster_books %>% group_by(`Staff List Name`) %>% summarise(n=n())

```


```{r}
# Filtering by staff list 
monster_books %>% filter(`Staff List Name` == "Celebrate Winter Holidays!")
```


```{r}
# Working with numeric variables (distributions)

monster_books %>% ggplot(aes(`Item Count`)) + 
  geom_histogram() +
  #geom_density(alpha = .2, fill = "pink2") + geom_density also a nice way to visualize distribution
  scale_x_continuous(breaks = seq(0, 150, by = 10),
    limits = c(0, 150)) +
  labs(title = "Item Count")

  
  
monster_books %>% ggplot(aes(Holds)) + 
  geom_bar() +
  #scale_x_continuous(breaks = seq(0, 150, by = 10),
   # limits = c(0, 150)) +
  labs(title = "Holds")


#boxplots w/ filtering 

monster_books %>% filter(Holds < 3 &  `Item Count` < 20) %>%  
  ggplot(aes(`Item Count`)) + 
  geom_boxplot() 

```





```{r}
# Finding all the duplicate books 
duplicate_books <- monster_books %>% group_by(Link) %>% filter(n()> 1) %>% summarise(Title, `Item Type`, `Staff List Name`, SL_Link, n = n())

#Counting the total number of duplicate books in our df 
length(unique(duplicate_books$Link))

```


```{r}
# Status and Item type counts 

monster_books %>% group_by(`Item Type`) %>% summarise(count = n())%>% arrange(desc(count))

monster_books %>% group_by(Status) %>% summarise(count = n())%>% arrange(desc(count))
```


```{r}
# Testing for how to parse subject and genre columns 

subject <- "Itliong, Larry, 1913-1977 — Juvenile literature, United Farm Workers of America — History — Juvenile literature, Labor leaders — United States — Biography — Juvenile literature, Filipino Americans — Biography — Juvenile literature, Agricultural laborers — Labor unions — United States — History — Biography — Juvenile literature, Discrimination - Kids, Southern Asian/Indian - Kids, Asian American - Kids"

beep <- unlist(str_split(subject, pattern = ",")) # using unlist here creates a character vector from a list (simpler indexing)


#Parsing for ratings 
rating_str <- "4.2 out of 5 stars, based on 83 ratings"

rating_str <- unlist(str_split(rating_str, pattern = ","))[1]

# Pattern that extracts either a decimal/integer as the first number. Don't need second number because it's always 5
# d represents any digit 0-9, | is the or operator that we're looking for a decimal or integer.
pattern <- "\\d+\\.\\d+|\\d+" 

rating <- as.numeric(str_extract(rating_str, pattern)) # Make it in a numeric variable because why not?

rating
```






```{r eval=FALSE, include=FALSE}
# Add a unique ID column to each book (don't need this because link is unique)

monster_books$book_id <- sapply(monster_books$Link, function(url) {
  
  # Use str_split to split the URL by "/"
  id_number <- str_split(url, pattern = "/")[[1]][6]
  
  return(id_number)
})
```